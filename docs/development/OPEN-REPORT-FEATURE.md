# SEC报告查看与下载功能完整方案

## 功能说明

现在提供了两种操作方式来处理SEC报告：
1. **查看按钮**：直接在浏览器新标签页中打开SEC报告进行在线查看
2. **下载按钮**：将SEC报告下载到本地计算机

这种双功能设计提供了最大的灵活性，用户可以根据需要选择在线查看或下载保存。

## 主要改动

### 1. 前端服务 (src/services/edgarAPI.ts)
- **保留原有 `downloadFile` 方法**：
  - 保持 `link.download` 属性，实现真正的下载功能
  - 文件会被下载到用户的默认下载文件夹
  
- **新增 `openFile` 方法**：
  - 使用 `window.open()` 在新窗口中打开SEC报告
  - 不设置 `link.download` 属性，实现在线查看
  - 添加弹窗阻止检测和备用方案

### 2. 服务器端代理功能
- **server/server.cjs**: 保持 `Content-Disposition: attachment` 以支持下载功能
- **api/edgar-full.cjs**: 同样保持下载响应头设置
- **默认内容类型**: 保持 `application/octet-stream` 以确保下载兼容性

### 3. UI界面增强
- **FilingDetailsModal.tsx**: 
  - 每个文件都有三个操作按钮：
    - **查看**按钮 (`fa-external-link-alt`) - 在线查看
    - **下载**按钮 (`fa-download`) - 下载到本地  
    - **复制链接**按钮 (`fa-link`) - 复制文件链接
  - 主要文档区域也提供查看和下载两个选项

- **FilingTable.tsx**:
  - 保持原有的下载按钮功能
  - "查看详情"按钮可以进入模态框看到更多操作选项

## 使用方式

1. **搜索公司**: 输入公司名称或股票代码
2. **查看列表**: 在结果列表中有两种操作选择：
   - 点击"下载"按钮：直接下载主要文档到本地
   - 点击"查看详情"：打开详情模态框查看所有文件
3. **详情模态框操作**:
   - **查看**：在新标签页中打开文件进行在线阅读
   - **下载**：将文件保存到本地计算机
   - **复制链接**：复制文件的直接链接地址

## 浏览器兼容性

- **现代浏览器**: 支持 `window.open()` 的所有现代浏览器
- **弹窗阻止**: 如果浏览器阻止弹窗，会提供备用方案和提示信息
- **安全性**: 使用 `noopener,noreferrer` 确保安全性

## 技术细节

### SEC API直接访问
- 所有报告链接都直接指向SEC官方服务器
- 支持各种文件格式：HTML、XML、PDF、XBRL等
- 服务器代理仅用于解决CORS问题，不改变文件内容

### 错误处理
- 弹窗被阻止时提供备用方案
- 无效链接时显示友好错误信息
- 网络错误时自动重试机制

## 与官方SEC API的集成

参考 [SEC EDGAR API文档](https://www.sec.gov/search-filings/edgar-application-programming-interfaces)：

1. **数据来源**: 直接使用SEC官方数据源
2. **实时性**: 报告内容实时同步SEC数据库
3. **格式支持**: 原生支持SEC的所有报告格式
4. **链接稳定性**: 使用SEC官方永久链接

## 测试建议

1. **基本功能测试**：
   - 搜索知名公司（如：Apple, Microsoft, Tesla）
   - 测试主表格的下载功能
   - 测试详情模态框的查看功能

2. **文件格式测试**：
   - 测试不同类型的报告（10-K, 10-Q, 8-K等）
   - 验证HTML、PDF、XML等格式的处理
   - 测试XBRL文件的打开效果

3. **浏览器兼容性**：
   - 验证在Chrome、Firefox、Edge等浏览器中的表现
   - 测试弹窗阻止情况下的备用方案
   - 确认下载功能在不同浏览器中正常工作

---

*最后更新: 2025年9月20日*
